<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ appTitle }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* -------------------- START: è‡ªè¨‚å­—é«”å€å¡Š -------------------- */
        
        /* 1. é™³æ‚…è½é›é«” - é€™æ˜¯æ‚¨çš„é è¨­å­—é«” */
        @font-face {
            font-family: 'ChenYuluoyan';
            src: url('./fonts/ChenYuluoyan-Thin.ttf') format('truetype'); 
            font-weight: normal;
            font-style: normal;
        }
        /* 2. Nanum Pen Script é«” */
        @font-face {
            font-family: 'NanumPenScript';
            src: url('./fonts/NanumPenScript-Regular.ttf') format('truetype'); 
            font-weight: normal;
            font-style: normal;
        }
        /* -------------------- END: è‡ªè¨‚å­—é«”å€å¡Š -------------------- */

        body {
            background: linear-gradient(180deg, #c3e0ff 0%, #ffffff 100%);
            background-attachment: fixed; 
        }
        #app {
            max-width: 420px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: white; 
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.08); 
            position: relative;
        }
        
        /* å‹•æ…‹ä¸»é¡Œé¡è‰²è®Šæ•¸ (CSS Variable) */
        :root {
            --primary-color: #3b82f6; 
        }

        /* å°èˆªæŒ‰éˆ•æ´»å‹•ç‹€æ…‹ */
        .nav-btn.active {
            color: var(--primary-color); 
            font-weight: 600;
        }

        /* é ‚éƒ¨æ—¥æœŸ Tab çš„æ¨£å¼ */
        .day-tab {
            background-color: white;
            color: #4b5563; 
        }
        .day-tab.active {
            background-color: var(--primary-color);
            color: #ffffff; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* æ‡‰ç”¨ä¸»é¡Œè‰²åˆ°é—œéµå…ƒä»¶ */
        .main-card-bg {
             background-color: var(--primary-color);
             box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .accounting-top-card {
            background-color: var(--primary-color);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* é£›æ©Ÿç§»å‹•å‹•ç•« (CSS ä¿®æ­£) */
        @keyframes fly {
            0% { transform: translateX(0); }
            50% { transform: translateX(calc(100% - 20px)); }
            100% { transform: translateX(0); }
        }
        .flight-progress {
            position: relative;
            height: 4px;
            background-color: #ffffff50;
        }
        .flight-progress .plane {
            position: absolute;
            top: -10px;
            font-size: 24px;
            transition: left 1s ease-in-out;
        }
        .flight-progress[data-status="æº–æ™‚"] .plane {
            left: 10%; 
        }
        .flight-progress[data-status="å»¶é² 15 åˆ†é˜"] .plane {
            left: 50%; 
        }
        .flight-progress[data-status="å·²æŠµé”"] .plane {
            left: calc(100% - 20px); 
        }
        .flight-progress[data-status="å–æ¶ˆ"] .plane {
            left: 0; 
            filter: grayscale(1);
        }
        .flight-progress[data-status="å·²ç™»æ©Ÿ"] .plane {
            left: 5%;
        }


    </style>
</head>
<body>

<div id="app" 
     :style="{ 
         'background': 'linear-gradient(180deg, ' + appBgColor + ' 0%, #ffffff 100%)', 
         'background-attachment': 'fixed',
         'font-family': selectedFont 
     }">
    <header class="p-4 pt-10 sticky top-0 bg-white bg-opacity-80 backdrop-blur-sm z-20">
        <div class="flex justify-between items-start">
            <h1 class="text-2xl font-semibold text-gray-900">{{ appTitle }}</h1>
            
            <div class="text-right text-sm text-gray-500">
                <p>åŸºç¤å¹£åˆ¥ï¼š<span class="font-medium text-gray-800">{{ baseCurrency }}</span></p>
                <p v-if="exchangeRate" class="font-medium mt-1">
                    1 JPY â‰ˆ {{ exchangeRate.toFixed(4) }} {{ baseCurrency }}
                </p>
                <p v-else class="text-xs text-red-500 mt-1">åŒ¯ç‡æ›´æ–°ä¸­...</p>
            </div>
        </div>
        
        <div v-if="currentTab === 'Schedule'" class="bg-gray-50 p-4 mt-4 rounded-xl shadow-inner border border-gray-100 flex justify-between items-center">
             <div>
                 <input type="text" v-model="weatherLocation" @keyup.enter="fetchWeather(weatherLocation)" 
                        placeholder="è¼¸å…¥åŸå¸‚åç¨± (ä¾‹å¦‚: London)"
                        class="text-xl font-bold bg-transparent focus:ring-0 focus:outline-none text-gray-800 p-0 m-0 w-full">
                
                <p class="text-sm text-gray-500 mt-1">{{ weather.date }} 
                    <span v-if="weather.loading" class="animate-pulse text-blue-500"> è¼‰å…¥ä¸­...</span>
                </p>
            </div>
            
            <div v-if="weather.temp" class="text-right flex items-center">
                <span class="text-4xl mr-3">{{ weather.icon }}</span>
                <div>
                    <p class="text-2xl font-bold text-gray-800">{{ weather.temp }}Â°C</p>
                    <p class="text-sm text-gray-500">{{ weather.description }}</p>
                </div>
            </div>
            <p v-else class="text-sm text-red-500">å¤©æ°£è¼‰å…¥å¤±æ•—</p>
        </div>


        <div class="flex overflow-x-auto py-3 space-x-3 mt-4">
            <button v-for="day in days" :key="day.date"
                    @click="currentDay = day.date"
                    class="day-tab flex-shrink-0 px-4 py-2 rounded-xl text-sm transition duration-200"
                    :class="{ 'active': currentDay === day.date }"
            >
                {{ day.label }}
                <span v-if="day.date !== 'PreTrip'" class="font-semibold ml-1">{{ day.dayOfMonth }}æ—¥</span>
            </button>
        </div>
    </header>

    <main class="p-4 pb-24 min-h-[calc(100vh-160px)]">
        
        <div v-if="currentTab === 'Schedule'">
            <h2 class="text-lg font-semibold text-gray-700 mb-3">{{ currentDayLabel }} è¡Œç¨‹å®‰æ’</h2>
            <button class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 mb-4" @click="showScheduleModal = true">
                <span class="text-sm font-medium text-blue-500 mr-1">+</span>æ–°å¢è¡Œç¨‹/æ´»å‹•
            </button>
            
            <div class="main-card-bg p-5 mb-5 rounded-2xl text-white shadow-xl">
                 <div class="flex justify-between items-start mb-3">
                    <h3 class="text-xl font-bold">âœˆï¸ èˆªç­è³‡è¨Š</h3>
                    <button class="text-gray-300 hover:text-white" @click="openEditModal('Flight', flightInfo)">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                    </button>
                </div>
                
                <div class="flex items-center mb-5">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/b/b3/China_Airlines_logo.svg" 
                         alt="è¯èˆª" class="w-8 h-8 mr-3 rounded-full bg-white p-1">
                    <span class="text-xl font-bold">{{ flightInfo.number }}</span>
                </div>
                <p class="text-lg font-bold mb-3" :class="{'text-yellow-300': flightInfo.status !== 'æº–æ™‚'}">
                     ç‹€æ…‹ï¼š{{ flightInfo.status }}
                </p>

                <div class="flex items-center justify-between text-sm mb-5 relative">
                    <div class="text-center">
                        <span class="block text-2xl">ğŸ›«</span>
                        <span class="text-xs">{{ flightInfo.departureAirport }}</span>
                    </div>

                    <div class="flex-1 h-1 mx-3 flight-progress" :data-status="flightInfo.status">
                        <span class="plane text-2xl">âœˆï¸</span>
                    </div>

                    <div class="text-center">
                        <span class="block text-2xl">ğŸ›¬</span>
                        <span class="text-xs">{{ flightInfo.arrivalAirport }}</span>
                    </div>
                </div>

                <div class="grid grid-cols-4 gap-y-3 gap-x-4 text-sm font-light">
                    <div>
                        <p class="font-medium">èˆªå»ˆ</p>
                        <p class="mt-1 font-semibold text-yellow-300 text-lg">{{ flightInfo.terminal }}</p>
                    </div>
                    <div>
                        <p class="font-medium">ç™»æ©Ÿé–€</p>
                        <p class="mt-1 font-semibold text-yellow-300 text-lg">{{ flightInfo.gate }}</p>
                    </div>
                    <div class="col-span-2"> 
                         <p class="font-medium">èµ·é£›æ™‚é–“ (TPE)</p>
                         <p class="mt-1 font-semibold text-lg">{{ flightInfo.departureTime }}</p>
                    </div>
                    
                    <div class="col-span-2"> 
                        <p class="font-medium">æŠµé”æ™‚é–“ (NRT)</p>
                        <p class="mt-1 font-semibold text-lg">{{ flightInfo.arrivalTime }}</p>
                    </div>
                    <div class="col-span-2"> 
                        <p class="font-medium">å»ºè­° Check-in</p>
                        <p class="mt-1 font-semibold text-lg">{{ flightInfo.checkInTime }}</p>
                    </div>
                </div>
            </div>
            
             <div v-for="item in filteredSchedule" :key="item.id" 
                 class="bg-white p-4 mb-4 rounded-2xl flex justify-between items-center shadow-md border border-gray-100">
                <div class="flex items-center">
                    <span v-if="item.time" class="text-lg font-bold mr-3 text-gray-800">{{ item.time }}</span>
                    <span class="text-lg text-gray-700">{{ item.name }}</span>
                </div>
                <button class="text-gray-400 hover:text-gray-600" @click="openEditModal('Schedule', item)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                </button>
            </div>

            <p v-if="filteredSchedule.length === 0" class="text-center text-gray-400 mt-10">æ­¤æ—¥æ²’æœ‰è¡Œç¨‹ç´€éŒ„</p>
        </div>
        
        <div v-else-if="currentTab === 'PreTrip'">
            <h2 class="text-lg font-semibold text-gray-700 mb-3">ä»£è¾¦æ¸…å–® (Todo List)</h2>
            <button class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 mb-4" @click="showTodoModal = true">
                <span class="text-sm font-medium text-blue-500 mr-1">+</span>æ–°å¢ä»£è¾¦äº‹é …
            </button>

            <div v-for="item in todoList" :key="item.id" class="bg-white p-4 mb-4 rounded-2xl flex justify-between items-center shadow-md border border-gray-100">
                <div class="flex items-center">
                    <input type="checkbox" :checked="item.completed" @change="item.completed = !item.completed" 
                           class="form-checkbox h-5 w-5 rounded-lg border-gray-300 mr-4 focus:ring-current"
                           :style="{ 'color': primaryColor, 'border-color': primaryColor }"
                    >
                    <span class="text-lg text-gray-700" :class="{ 'line-through text-gray-400': item.completed }">
                        {{ item.name }}
                    </span>
                </div>
                <div class="flex space-x-2">
                    <button class="text-gray-400 hover:text-gray-600" @click="openEditModal('Todo', item)">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                    </button>
                    <button class="text-gray-400 hover:text-red-500" @click="deleteItem('Todo', item.id)">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <div v-else-if="currentTab === 'Accounting'">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">æ—…è²»ç®¡ç†</h2>
            
            <div class="accounting-top-card p-6 mb-6 rounded-2xl shadow-xl">
                <p class="text-sm font-light text-gray-200">ç¸½æ”¯å‡º ({{ baseCurrency }})</p>
                <h3 class="text-4xl font-extrabold my-2">{{ baseCurrencySymbol }}{{ totalExpense }}</h3>
            </div>

            <h3 class="text-md font-semibold text-gray-700 mb-3">æ”¯å‡ºæ˜ç´°</h3>
            <div class="flex justify-between items-center mb-4">
                <div class="p-1 bg-gray-100 rounded-xl flex max-w-xs">
                    <button class="flex-1 py-2 px-4 rounded-lg text-sm text-gray-600 transition duration-150" 
                        :class="{'bg-white shadow-md font-medium': expenseFilter === 'all'}" @click="expenseFilter = 'all'">å…¨éƒ¨</button>
                    <button class="flex-1 py-2 px-4 rounded-lg text-sm text-gray-600 transition duration-150" 
                        :class="{'bg-white shadow-md font-medium': expenseFilter === 'cash'}" @click="expenseFilter = 'cash'">ç¾é‡‘</button>
                    <button class="flex-1 py-2 px-4 rounded-lg text-sm text-gray-600 transition duration-150" 
                        :class="{'bg-white shadow-md font-medium': expenseFilter === 'credit'}" @click="expenseFilter = 'credit'">ä¿¡ç”¨å¡</button>
                </div>
                <button class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700" @click="showAccountingModal = true">
                    <span class="text-sm font-medium text-blue-500 mr-1">+</span>è¨˜ä¸€ç­†
                </button>
            </div>
            
            <p v-if="filteredExpenses.length === 0" class="text-center text-gray-400 mt-10">æ²’æœ‰ç›¸é—œçš„æ”¯å‡ºç´€éŒ„</p>

            <ul class="space-y-3">
                <li v-for="expense in filteredExpenses" :key="expense.id" 
                    @click="openEditModal('Accounting', expense)"
                    class="bg-white p-4 rounded-xl flex justify-between items-center shadow-sm border border-gray-100 hover:shadow-lg transition cursor-pointer">
                    <div>
                        <p class="font-medium text-gray-800">{{ expense.name }}</p>
                        <p class="text-xs text-gray-400 mt-1">
                            {{ expense.type === 'cash' ? 'ğŸ’µ ç¾é‡‘' : 'ğŸ’³ ä¿¡ç”¨å¡' }} 
                            - {{ expense.currency }} 
                            <span v-if="expense.currency !== baseCurrency">({{ baseCurrencySymbol }}{{ convertToBaseCurrency(expense.amount, expense.currency).toFixed(0) }})</span>
                        </p>
                    </div>
                    <span class="text-lg font-bold text-red-600">
                        {{ getCurrencySymbol(expense.currency) }}{{ expense.amount.toFixed(0) }}
                    </span>
                </li>
            </ul>

        </div>
        
        <div v-else-if="currentTab === 'Shopping'">
            <h2 class="text-lg font-semibold text-gray-700 mb-3">è³¼ç‰©æ¸…å–®</h2>
            <button class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 mb-4" @click="showShoppingModal = true">
                <span class="text-sm font-medium text-blue-500 mr-1">+</span>æ–°å¢é …ç›®
            </button>

            <div v-for="item in shoppingList" :key="item.id" class="bg-white p-4 mb-4 rounded-2xl flex justify-between items-center shadow-md border border-gray-100">
                <div class="flex items-center">
                    <img :src="item.imgUrl" alt="å•†å“åœ–ç‰‡" class="w-16 h-16 object-cover rounded-xl mr-4 border border-gray-100">
                    <div>
                        <p class="text-lg font-medium text-gray-800">{{ item.name }}</p>
                        <p class="text-md text-gray-600 mt-1">Â¥ {{ item.price }}</p>
                    </div>
                </div>
                 <div class="flex space-x-2">
                    <button class="text-gray-400 hover:text-gray-600" @click="openEditModal('Shopping', item)">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                    </button>
                    <button class="text-gray-400 hover:text-red-500" @click="deleteItem('Shopping', item.id)">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <div v-else-if="currentTab === 'Settings'">
            <h2 class="text-2xl font-semibold mb-6 text-gray-700">âš™ï¸ è¨­å®šèˆ‡ä¸»é¡Œ</h2>

            <div class="bg-white p-4 mb-4 rounded-xl shadow-md border border-gray-100">
                <h3 class="font-medium mb-3 text-gray-700">æ—…éŠæ—¥æœŸèˆ‡å¤©æ•¸</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">æ—…è¡Œèµ·å§‹æ—¥æœŸ (Day 1)</label>
                        <input type="date" v-model="tripStartDate" required
                               class="w-full p-2 border border-gray-200 rounded-lg focus:ring-blue-300 focus:border-blue-300 transition duration-150">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">ç¸½æ—…è¡Œå¤©æ•¸</label>
                        <input type="number" v-model.number="totalTripDays" min="1" max="30" required
                               class="w-full p-2 border border-gray-200 rounded-lg focus:ring-blue-300 focus:border-blue-300 transition duration-150">
                    </div>
                </div>
            </div>

            <div class="bg-white p-4 mb-4 rounded-xl shadow-md border border-gray-100">
                <h3 class="font-medium mb-3 text-gray-700">å°ˆæ¡ˆåç¨±/æš±ç¨±</h3>
                <input type="text" v-model="appTitle" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„æ—…ç¨‹App" class="w-full p-2 border border-gray-200 rounded-lg focus:ring-blue-300 focus:border-blue-300 transition duration-150">
            </div>

            <div class="bg-white p-4 mb-4 rounded-xl shadow-md border border-gray-100">
                <h3 class="font-medium mb-3 text-gray-700">é¸æ“‡ App å­—é«”</h3>
                <select v-model="selectedFont" class="w-full p-2 border border-gray-200 rounded-lg bg-white text-gray-700 focus:ring-current" :style="{ 'border-color': primaryColor }">
                    <option v-for="font in fontOptions" :key="font.id" :value="font.id">
                        {{ font.name }}
                    </option>
                </select>
                <p class="text-xs text-gray-500 mt-2">é¸æ“‡å¾Œ App å°‡å³æ™‚åˆ‡æ›å­—é«”ã€‚</p>
            </div>


            <div class="bg-white p-4 mb-4 rounded-xl shadow-md border border-gray-100">
                <h3 class="font-medium mb-3 text-gray-700">App åŸºç¤çµç®—è²¨å¹£</h3>
                <select v-model="baseCurrency" @change="fetchExchangeRate" class="w-full p-2 border border-gray-200 rounded-lg bg-white text-gray-700 focus:ring-current" :style="{ 'border-color': primaryColor }">
                    <option value="TWD">TWD - æ–°å°å¹£</option>
                    <option value="USD">USD - ç¾å…ƒ</option>
                    <option value="JPY">JPY - æ—¥å¹£</option>
                    <option value="CNY">CNY - äººæ°‘å¹£</option>
                    <option value="EUR">EUR - æ­å…ƒ</option>
                    <option value="KRW">KRW - éŸ“å…ƒ</option>
                    <option value="GBP">GBP - è‹±éŠ</option>
                </select>
                <p class="text-xs text-gray-500 mt-2">æ›´æ”¹å¾Œï¼ŒApp å°‡è‡ªå‹•å˜—è©¦æ›´æ–°åŒ¯ç‡ä¸¦è¨ˆç®—ç¸½æ”¯å‡ºã€‚</p>
            </div>


            <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                <h3 class="font-medium mb-3 text-gray-700">è‡ªè¨‚ App ä¸»é¡Œé¡è‰²</h3>
                <div class="flex items-center space-x-3">
                    <input type="color" v-model="primaryColorInput" @input="updateTheme(primaryColorInput)" class="rounded-lg">
                    <span class="font-mono text-sm text-gray-600">{{ primaryColorInput }}</span>
                </div>
            </div>
        </div>
    </main>
    
    <nav class="fixed bottom-0 left-0 right-0 max-w-sm mx-auto z-30">
        <div class="flex justify-around items-center bg-white p-3 mx-4 mb-4 rounded-full shadow-2xl">
            <button @click="currentTab = 'Schedule'" class="nav-btn flex flex-col items-center p-2" :class="{ 'active': currentTab === 'Schedule' }">
                 <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-4 4h.01M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><span class="text-xs mt-1">è¡Œç¨‹</span></button>
            <button @click="currentTab = 'PreTrip'" class="nav-btn flex flex-col items-center p-2" :class="{ 'active': currentTab === 'PreTrip' }">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5h6"></path></svg><span class="text-xs mt-1">ä»£è¾¦</span></button>
            <button @click="currentTab = 'Accounting'" class="nav-btn flex flex-col items-center p-2" :class="{ 'active': currentTab === 'Accounting' }">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V6m0 6v-1m0 1v3m0 0h.01M12 18V9.143a4.99 4.99 0 00-3-1.071M12 18L7.143 18m4.857-0L16.857 18"></path></svg><span class="text-xs mt-1">è¨˜å¸³</span></button>
            <button @click="currentTab = 'Shopping'" class="nav-btn flex flex-col items-center p-2" :class="{ 'active': currentTab === 'Shopping' }">
                 <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg><span class="text-xs mt-1">è³¼ç‰©</span></button>
             <button @click="currentTab = 'Settings'" class="nav-btn flex flex-col items-center p-2" :class="{ 'active': currentTab === 'Settings' }">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="text-xs mt-1">è¨­å®š</span></button>
        </div>
    </nav>
    
    <div v-if="showAccountingModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-end justify-center z-40" @click.self="showAccountingModal = false">
        <div class="bg-white w-full max-w-sm rounded-t-3xl p-6 shadow-2xl transform translate-y-0 transition duration-300">
            <h3 class="text-xl font-medium mb-4 text-gray-800 border-b pb-2">æ–°å¢æ”¯å‡ºç´€éŒ„ (åŸºç¤å¹£åˆ¥: {{ baseCurrency }})</h3>
            
            <form @submit.prevent="addExpense" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">é‡‘é¡</label>
                    <div class="flex">
                         <select v-model="newExpense.currency" required class="p-3 border border-gray-300 rounded-l-lg bg-gray-50 text-gray-700">
                            <option value="TWD">TWD</option>
                            <option value="USD">USD</option>
                            <option value="JPY">JPY</option>
                            <option value="CNY">CNY</option>
                            <option value="EUR">EUR</option>
                            <option value="KRW">KRW</option>
                            <option value="GBP">GBP</option>
                        </select>
                        <input type="number" step="1" v-model.number="newExpense.amount" required
                           class="flex-1 p-3 border border-gray-300 rounded-r-lg text-lg focus:ring-current focus:border-current"
                           :style="{ 'border-color': primaryColor, 'focus-ring-color': primaryColor, 'focus-border-color': primaryColor }"
                           placeholder="100">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">ç”¨é€”æè¿°</label>
                    <input type="text" v-model="newExpense.name" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-current focus:border-current"
                           :style="{ 'border-color': primaryColor, 'focus-ring-color': primaryColor, 'focus-border-color': primaryColor }"
                           placeholder="ä¾‹å¦‚ï¼šæ™šé¤ã€è¨ˆç¨‹è»Š">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">æ”¯ä»˜æ–¹å¼</label>
                        <select v-model="newExpense.type" required class="w-full p-3 border border-gray-300 rounded-lg bg-white text-gray-700">
                            <option value="cash">ğŸ’µ ç¾é‡‘</option>
                            <option value="credit">ğŸ’³ ä¿¡ç”¨å¡</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">æ‰€å±¬æ—¥æœŸ</label>
                        <select v-model="newExpense.date" required class="w-full p-3 border border-gray-300 rounded-lg bg-white text-gray-700">
                             <option v-for="day in days" :key="day.date" :value="day.date">
                                {{ day.label }} 
                                <span v-if="day.date !== 'PreTrip'">({{ day.dayOfMonth }}æ—¥)</span>
                            </option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="w-full py-3 text-white font-medium rounded-lg shadow-md transition duration-200 mt-6"
                        :style="{ 'background-color': primaryColor, 'hover-background-color': primaryColor }">
                    å„²å­˜ç´€éŒ„
                </button>
            </form>

            <button class="mt-4 w-full py-2 text-gray-500 rounded-lg border border-gray-200 hover:bg-gray-50" @click="showAccountingModal = false">
                å–æ¶ˆ
            </button>
        </div>
    </div>


    <div v-if="showTodoModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-end justify-center z-40" @click.self="showTodoModal = false">
        <div class="bg-white w-full max-w-sm rounded-t-3xl p-6 shadow-2xl">
             <h3 class="text-xl font-medium mb-4 text-gray-800 border-b pb-2">æ–°å¢è¡Œå‰ä»£è¾¦äº‹é …</h3>
            <form @submit.prevent="addTodoItem" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">ä»£è¾¦äº‹é …å…§å®¹</label>
                    <input type="text" v-model="newTodo.name" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-current focus:border-current"
                           :style="{ 'border-color': primaryColor, 'focus-ring-color': primaryColor, 'focus-border-color': primaryColor }"
                           placeholder="ä¾‹å¦‚ï¼šå…Œæ›æ—¥å¹£">
                </div>
                 <button type="submit" class="w-full py-3 text-white font-medium rounded-lg shadow-md transition duration-200 mt-6"
                        :style="{ 'background-color': primaryColor, 'hover-background-color': primaryColor }">
                    æ–°å¢
                </button>
            </form>
            <button class="mt-4 w-full py-2 text-gray-500 rounded-lg border border-gray-200 hover:bg-gray-50" @click="showTodoModal = false">
                å–æ¶ˆ
            </button>
        </div>
    </div>

    <div v-if="showShoppingModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-end justify-center z-40" @click.self="showShoppingModal = false">
        <div class="bg-white w-full max-w-sm rounded-t-3xl p-6 shadow-2xl">
             <h3 class="text-xl font-medium mb-4 text-gray-800 border-b pb-2">æ–°å¢è³¼ç‰©æ¸…å–®é …ç›®</h3>
            <form @submit.prevent="addShoppingItem" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">å•†å“åç¨±</label>
                    <input type="text" v-model="newShoppingItem.name" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-current focus:border-current"
                           :style="{ 'border-color': primaryColor, 'focus-ring-color': primaryColor, 'focus-border-color': primaryColor }"
                           placeholder="ä¾‹å¦‚ï¼šæ±äº¬é¦™è•‰">
                </div>
                 <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">åƒ¹æ ¼ (JPY)</label>
                    <input type="number" v-model.number="newShoppingItem.price" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-current focus:border-current"
                           :style="{ 'border-color': primaryColor, 'focus-ring-color': primaryColor, 'focus-border-color': primaryColor }"
                           placeholder="1000">
                </div>
                 <button type="submit" class="w-full py-3 text-white font-medium rounded-lg shadow-md transition duration-200 mt-6"
                        :style="{ 'background-color': primaryColor, 'hover-background-color': primaryColor }">
                    æ–°å¢
                </button>
            </form>
            <button class="mt-4 w-full py-2 text-gray-500 rounded-lg border border-gray-200 hover:bg-gray-50" @click="showShoppingModal = false">
                å–æ¶ˆ
            </button>
        </div>
    </div>


    <div v-if="showScheduleModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-end justify-center z-40" @click.self="showScheduleModal = false">
        <div class="bg-white w-full max-w-sm rounded-t-3xl p-6 shadow-2xl">
             <h3 class="text-xl font-medium mb-4 text-gray-800 border-b pb-2">æ–°å¢è¡Œç¨‹é …ç›® ({{ currentDayLabel }})</h3>
            <form @submit.prevent="addScheduleItem" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">æ™‚é–“ (é¸å¡«)</label>
                    <input type="time" v-model="newScheduleItem.time"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-current focus:border-current">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">æ´»å‹•/åœ°é»åç¨±</label>
                    <input type="text" v-model="newScheduleItem.name" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-current focus:border-current"
                           :style="{ 'border-color': primaryColor, 'focus-ring-color': primaryColor, 'focus-border-color': primaryColor }"
                           placeholder="ä¾‹å¦‚ï¼šè¿ªå£«å°¼æ¨‚åœ’">
                </div>
                 <button type="submit" class="w-full py-3 text-white font-medium rounded-lg shadow-md transition duration-200 mt-6"
                        :style="{ 'background-color': primaryColor, 'hover-background-color': primaryColor }">
                    æ–°å¢è¡Œç¨‹
                </button>
            </form>
            <button class="mt-4 w-full py-2 text-gray-500 rounded-lg border border-gray-200 hover:bg-gray-50" @click="showScheduleModal = false">
                å–æ¶ˆ
            </button>
        </div>
    </div>


     <div v-if="showEditModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-end justify-center z-40" @click.self="showEditModal = false">
        <div class="bg-white w-full max-w-sm rounded-t-3xl p-6 shadow-2xl transform translate-y-0 transition duration-300">
            <h3 class="text-xl font-medium mb-4 text-gray-800 border-b pb-2">ç·¨è¼¯ {{ editingItem.typeLabel }}</h3>
            
            <form @submit.prevent="saveEdit" class="space-y-4">
                
                <div v-if="editingItem.type !== 'Accounting' && editingItem.type !== 'Flight'">
                    <label class="block text-sm font-medium text-gray-600 mb-1">{{ editingItem.typeLabel }} åç¨±</label>
                    <input type="text" v-model="editingItem.data.name" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-current focus:border-current"
                           :style="{ 'border-color': primaryColor, 'focus-ring-color': primaryColor, 'focus-border-color': primaryColor }">
                </div>

                <div v-if="editingItem.type === 'Accounting'">
                     <label class="block text-sm font-medium text-gray-600 mb-1">é‡‘é¡</label>
                    <div class="flex">
                         <select v-model="editingItem.data.currency" required class="p-3 border border-gray-300 rounded-l-lg bg-gray-50 text-gray-700">
                            <option value="TWD">TWD</option>
                            <option value="USD">USD</option>
                            <option value="JPY">JPY</option>
                            <option value="CNY">CNY</option>
                            <option value="EUR">EUR</option>
                            <option value="KRW">KRW</option>
                            <option value="GBP">GBP</option>
                        </select>
                        <input type="number" step="1" v-model.number="editingItem.data.amount" required
                           class="flex-1 p-3 border border-gray-300 rounded-r-lg text-lg focus:ring-current focus:border-current"
                           :style="{ 'border-color': primaryColor, 'focus-ring-color': primaryColor, 'focus-border-color': primaryColor }">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">æ”¯ä»˜æ–¹å¼</label>
                            <select v-model="editingItem.data.type" required class="w-full p-3 border border-gray-300 rounded-lg bg-white text-gray-700">
                                <option value="cash">ğŸ’µ ç¾é‡‘</option>
                                <option value="credit">ğŸ’³ ä¿¡ç”¨å¡</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">æ‰€å±¬æ—¥æœŸ</label>
                            <select v-model="editingItem.data.date" required class="w-full p-3 border border-gray-300 rounded-lg bg-white text-gray-700">
                                <option v-for="day in days" :key="day.date" :value="day.date">
                                    {{ day.label }} 
                                    <span v-if="day.date !== 'PreTrip'">({{ day.dayOfMonth }}æ—¥)</span>
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
                
                 <div v-if="editingItem.type === 'Flight'" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">èˆªç­ç·¨è™Ÿ</label>
                        <input type="text" v-model="editingItem.data.number" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                     <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">èµ·é£›æ©Ÿå ´ä»£è™Ÿ</label>
                            <input type="text" v-model="editingItem.data.departureAirport" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                         <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">æŠµé”æ©Ÿå ´ä»£è™Ÿ</label>
                            <input type="text" v-model="editingItem.data.arrivalAirport" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">èˆªå»ˆ (Terminal)</label>
                            <input type="text" v-model="editingItem.data.terminal" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">ç™»æ©Ÿé–€ (Gate)</label>
                            <input type="text" v-model="editingItem.data.gate" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">èµ·é£›æ™‚é–“ (24H)</label>
                            <input type="time" v-model="editingItem.data.departureTime" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">æŠµé”æ™‚é–“ (24H)</label>
                            <input type="time" v-model="editingItem.data.arrivalTime" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                     <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">å»ºè­° Check-in æ™‚é–“</label>
                        <input type="time" v-model="editingItem.data.checkInTime" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                </div>

                <button type="submit" class="w-full py-3 text-white font-medium rounded-lg shadow-md transition duration-200 mt-6"
                        :style="{ 'background-color': primaryColor, 'hover-background-color': primaryColor }">
                    ç¢ºèªä¿®æ”¹
                </button>
            </form>

            <button v-if="editingItem.type !== 'Flight'" class="mt-4 w-full py-2 text-red-500 rounded-lg border border-gray-200 hover:bg-gray-50" 
                    @click="deleteAndCloseEditModal(editingItem.type, editingItem.data.id)">
                åˆªé™¤æ­¤é …ç›®
            </button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue

    createApp({
        setup() {
            // åŸºç¤ç‹€æ…‹
            const appTitle = ref('TRAVEL') // ã€ä¿®æ­£ 1ã€‘ ç¶²é åç¨±
            const currentTab = ref('Schedule') 
            
            // --- å­—é«”é¸æ“‡ç‹€æ…‹ ---
            const fontOptions = ref([
                { id: 'sans-serif', name: 'ç³»çµ±é è¨­å­—é«”' },
                { id: 'ChenYuluoyan', name: 'é™³æ‚…è½é›é«” (Thin)' }, 
                { id: 'NanumPenScript', name: 'NanumPenScript (æ‰‹å¯«é«”)' } 
            ]);
            const selectedFont = ref('ChenYuluoyan'); // ã€ä¿®æ­£ 2ã€‘ é è¨­ä½¿ç”¨é™³æ‚…è½é›é«”
            
            // --- æ—…éŠæ—¥æœŸè¨­å®š ---
            const tripStartDate = ref('2025-12-08'); 
            const totalTripDays = ref(4);
            const currentDay = ref(tripStartDate.value); 

            // --- è²¨å¹£å’ŒåŒ¯ç‡ç‹€æ…‹ ---
            const baseCurrency = ref('TWD') 
            const exchangeRates = ref({})  
            const exchangeRate = ref(0.21) 

            // --- å¤©æ°£ç‹€æ…‹ ---
            const weatherLocation = ref('Taipei'); 
            const weather = ref({
                temp: 28,
                description: 'å¤šé›²ï¼Œå¶é™£é›¨',
                icon: 'ğŸŒ§ï¸',
                date: '12æœˆ12æ—¥',
                loading: false
            });

            // --- èˆªç­è³‡è¨Šç‹€æ…‹ (æ–°å¢èˆªå»ˆ/ç™»æ©Ÿé–€) ---
            const flightInfo = ref({
                number: 'CI100', 
                status: 'æº–æ™‚', 
                departureTime: '09:05',
                departureAirport: 'TPE',
                arrivalTime: '13:00',
                arrivalAirport: 'NRT',
                checkInTime: '07:00',
                terminal: 'T2',      
                gate: 'B10'          
            });

            // --- æ¨¡æ…‹æ¡†ç‹€æ…‹ ---
            const showAccountingModal = ref(false)
            const showTodoModal = ref(false) 
            const showShoppingModal = ref(false) 
            const showScheduleModal = ref(false) 
            const showEditModal = ref(false)
            const editingItem = ref({ type: '', typeLabel: '', data: null }); 
            
            // --- æ–°å¢é …ç›®è¡¨å–®ç‹€æ…‹ ---
            const newExpense = ref({
                amount: null, name: '', type: 'cash', currency: 'JPY', date: '2025-12-08' 
            })
            const newTodo = ref({ 
                name: ''
            })
            const newShoppingItem = ref({ 
                name: '',
                price: null
            })
            const newScheduleItem = ref({ 
                 time: '',
                 name: ''
            })
            
            // ä¸»é¡Œé¡è‰²ç‹€æ…‹
            const primaryColorInput = ref('#3b82f6')
            const primaryColor = ref('#3b82f6')
            const appBgColor = ref('#c3e0ff')
            
            // æ•¸æ“šæ¸…å–®
            const expenses = ref([
                { id: 101, name: 'åˆé¤ï¼šæ‹‰éºµ', amount: 1500, currency: 'JPY', type: 'cash', date: '2025-12-08' },
                { id: 104, name: 'ä¿éšª', amount: 1000, currency: 'TWD', type: 'credit', date: 'PreTrip' },
            ])
            const expenseFilter = ref('all') 
            
            const todoList = ref([
                { id: 1, name: 'è³¼è²·æ—…éŠä¿éšª', completed: false },
                { id: 2, name: 'è²·ç¶²å¡/SIMå¡', completed: true },
            ])
            
            const shoppingList = ref([
                { id: 201, name: 'CEZANNE 101è™Ÿå”‡è†', price: 3000, imgUrl: 'https://via.placeholder.com/150/f9fafb/555555?text=Lipstick', purchased: false },
            ])
            
            const scheduleList = ref([
                { id: 1, name: 'é£›æ©ŸæŠµé” NRT', time: '13:00', date: '2025-12-08' },
                { id: 2, name: 'é£¯åº— Check-in', time: '15:00', date: '2025-12-08' },
                { id: 3, name: 'æ™šé¤ï¼šå£½å¸å¤§', time: '18:30', date: '2025-12-08' },
            ])


            // --- Computed å±¬æ€§ ---
            
            const days = computed(() => {
                const dayList = [{ label: 'è¡Œå‰', date: 'PreTrip', dayOfMonth: '' }]; 
                const startDate = new Date(tripStartDate.value);
                
                for (let i = 0; i < totalTripDays.value; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    
                    const isoDate = date.toISOString().split('T')[0]; 
                    const dayOfMonth = date.getDate().toString().padStart(2, '0'); 
                    
                    dayList.push({ label: `Day ${i + 1}`, date: isoDate, dayOfMonth: dayOfMonth });
                }
                
                if (!dayList.find(d => d.date === currentDay.value) && totalTripDays.value > 0) {
                     currentDay.value = dayList[1].date; 
                }
                return dayList;
            })
            
            const currentDayLabel = computed(() => {
                return days.value.find(d => d.date === currentDay.value)?.label || 'ç•¶å‰';
            })
            
            const baseCurrencySymbol = computed(() => getCurrencySymbol(baseCurrency.value));

            const convertToBaseCurrency = (amount, currency) => {
                if (currency === baseCurrency.value) { return amount; }
                const rateFrom = exchangeRates.value[currency];

                if (exchangeRates.value[baseCurrency.value] === 1) { 
                    return amount / rateFrom;
                }
                
                // Fallback é‚è¼¯
                if (currency === 'JPY' && baseCurrency.value === 'TWD') { return amount * 0.21; }
                return amount; 
            }

            const totalExpense = computed(() => {
                return expenses.value
                    .filter(e => e.date !== 'PreTrip')
                    .reduce((sum, e) => sum + convertToBaseCurrency(Math.abs(e.amount), e.currency), 0)
                    .toFixed(0);
            })

            const filteredExpenses = computed(() => {
                 return expenses.value.filter(e => {
                    const dateMatch = (currentDay.value === 'PreTrip' && e.date === 'PreTrip') || 
                                     (currentDay.value !== 'PreTrip' && e.date === currentDay.value);
                                     
                    if (expenseFilter.value === 'all') return dateMatch;
                    return dateMatch && e.type === expenseFilter.value;
                });
            })
            
            const filteredSchedule = computed(() => {
                return scheduleList.value
                    .filter(item => item.date === currentDay.value)
                    .sort((a, b) => a.time.localeCompare(b.time)); 
            })


            // --- Methods ---

            // ç²å–å¯¦æ™‚åŒ¯ç‡ (ä»¥ baseCurrency ç‚ºåŸºæº–)
            const fetchExchangeRate = async () => {
                const dynamicApiEndpoint = `https://api.exchangerate-api.com/v4/latest/${baseCurrency.value}`;
                exchangeRate.value = null; 

                try {
                    const response = await fetch(dynamicApiEndpoint);
                    if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥åŒ¯ç‡æ•¸æ“š');
                    
                    const data = await response.json();
                    
                    if (data && data.rates) {
                        exchangeRates.value = data.rates;
                        // é¡¯ç¤º JPY å…Œæ› baseCurrency çš„åŒ¯ç‡ (æ–¹ä¾¿æŸ¥çœ‹ç›®æ¨™è²¨å¹£)
                        exchangeRate.value = data.rates['JPY']; 
                    } else {
                         throw new Error('åŒ¯ç‡æ•¸æ“šæ ¼å¼éŒ¯èª¤');
                    }
                } catch (error) {
                    console.error('ç²å–åŒ¯ç‡å¤±æ•—:', error);
                    // é è¨­åŒ¯ç‡ (ä»¥ TWD ç‚ºåŸºæº–çš„æ¨¡æ“¬åŒ¯ç‡ï¼Œæ–¹ä¾¿æœ¬åœ°æ¸¬è©¦)
                    exchangeRates.value = { 
                        "TWD": 1, "USD": 0.032, "JPY": 4.75, "CNY": 0.23, "EUR": 0.029, 
                        "KRW": 39.5, "GBP": 0.025 
                    }; 
                    // å¦‚æœ baseCurrency æ˜¯ TWDï¼Œå‰‡é¡¯ç¤º JPY å…Œæ› TWD çš„åŒ¯ç‡ (1 JPY = 0.21 TWD, 1 TWD = 4.75 JPY)
                    exchangeRate.value = exchangeRates.value['JPY'] || 4.75; 
                }
            }
            
            // ç²å–å¤©æ°£è³‡è¨Š 
            const fetchWeather = async (location = weatherLocation.value) => {
                weather.value = { 
                    temp: null, 
                    description: 'è¼‰å…¥ä¸­...', 
                    icon: 'â³', 
                    date: new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' }),
                    loading: true
                };
                
                await new Promise(resolve => setTimeout(resolve, 800)); 
                
                const lowerLocation = location.toLowerCase();

                if (lowerLocation.includes('taipei') || lowerLocation.includes('å°åŒ—')) {
                     weather.value = { temp: 28, description: 'å¤šé›²ï¼Œå¶é™£é›¨', icon: 'ğŸŒ§ï¸', date: new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' }), loading: false };
                } else if (lowerLocation.includes('tokyo') || lowerLocation.includes('æ±äº¬') || lowerLocation.includes('nrt')) {
                     weather.value = { temp: 20, description: 'æ™´æœ—ï¼Œå¾®é¢¨', icon: 'â˜€ï¸', date: new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' }), loading: false };
                } else if (lowerLocation.includes('seoul') || lowerLocation.includes('é¦–çˆ¾')) {
                     weather.value = { temp: 15, description: 'æ™´æœ—ï¼Œä¹¾ç‡¥', icon: 'ğŸ”†', date: new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' }), loading: false };
                } else if (lowerLocation.includes('bangkok') || lowerLocation.includes('æ›¼è°·')) {
                     weather.value = { temp: 33, description: 'ç‚ç†±ï¼Œæœ‰é›·é™£é›¨', icon: 'â›ˆï¸', date: new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' }), loading: false };
                } else if (lowerLocation.includes('london') || lowerLocation.includes('å€«æ•¦') || lowerLocation.includes('gbp')) {
                     weather.value = { temp: 12, description: 'é™°å¤©ï¼Œéœ§æ¿›æ¿›', icon: 'ğŸŒ«ï¸', date: new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' }), loading: false };
                } else if (lowerLocation.includes('paris') || lowerLocation.includes('å·´é»')) {
                     weather.value = { temp: 18, description: 'æ™´ç©ºè¬é‡Œ', icon: 'ğŸŒ', date: new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' }), loading: false };
                } else {
                     weather.value = { temp: null, description: `æœªæ‰¾åˆ° ${location} çš„æ¨¡æ“¬æ•¸æ“š`, icon: 'âŒ', date: new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' }), loading: false };
                }
                weatherLocation.value = location; 
            }
            
            // å¯¦æ™‚èˆªç­è¿½è¹¤åŠŸèƒ½ (æ¨¡æ“¬)
            const fetchFlightStatus = async () => {
                if (!flightInfo.value.number) return; 
                await new Promise(resolve => setTimeout(resolve, 1000)); 

                console.log(`æ­£åœ¨æ¨¡æ“¬è¿½è¹¤èˆªç­ ${flightInfo.value.number} çš„å¯¦æ™‚ç‹€æ…‹...`);
                
                const currentStatus = ['æº–æ™‚', 'å»¶é² 15 åˆ†é˜', 'å·²ç™»æ©Ÿ', 'å·²æŠµé”', 'å–æ¶ˆ'];
                const randomStatus = currentStatus[Math.floor(Math.random() * currentStatus.length)];
                
                flightInfo.value.status = randomStatus; 
                // æ¨¡æ“¬ç™»æ©Ÿé–€æˆ–èˆªå»ˆè®Šæ›´
                if (randomStatus === 'å»¶é² 15 åˆ†é˜') {
                     flightInfo.value.gate = 'C05';
                     flightInfo.value.terminal = 'T1';
                }
            }


            const getCurrencySymbol = (currency) => {
                switch(currency) {
                    case 'TWD': return '$';
                    case 'USD': return '$';
                    case 'JPY': return 'Â¥';
                    case 'CNY': return 'Â¥';
                    case 'EUR': return 'â‚¬';
                    case 'KRW': return 'â‚©'; 
                    case 'GBP': return 'Â£'; 
                    default: return '';
                }
            }

            const updateTheme = (hex) => {
                primaryColor.value = hex;
                document.documentElement.style.setProperty('--primary-color', hex);
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                
                if (g > r && g > b) { appBgColor.value = '#d1fae5'; } 
                else if (r > b) { appBgColor.value = '#fbe2e2'; } 
                else { appBgColor.value = '#c3e0ff'; }
            }
            
            const addExpense = () => {
                if (!newExpense.value.amount || !newExpense.value.name) return;

                const expense = { ...newExpense.value, id: Date.now(), amount: Math.abs(newExpense.value.amount) };
                expenses.value.push(expense);
                
                newExpense.value = { amount: null, name: '', type: 'cash', currency: 'JPY', date: currentDay.value || days.value[1].date };
                showAccountingModal.value = false;
                if (currentTab.value !== 'Accounting') { currentTab.value = 'Accounting'; }
            }
            
            const addTodoItem = () => {
                if (!newTodo.value.name) return;
                
                const item = {
                    id: Date.now(),
                    name: newTodo.value.name,
                    completed: false
                };
                
                todoList.value.push(item);
                newTodo.value.name = ''; 
                showTodoModal.value = false;
            }

            const addShoppingItem = () => {
                if (!newShoppingItem.value.name || !newShoppingItem.value.price) return;
                
                const item = {
                    id: Date.now(),
                    name: newShoppingItem.value.name,
                    price: newShoppingItem.value.price,
                    imgUrl: 'https://via.placeholder.com/150/f9fafb/555555?text=Shopping', 
                    purchased: false
                };
                
                shoppingList.value.push(item);
                newShoppingItem.value = { name: '', price: null }; 
                showShoppingModal.value = false;
            }
            
            const addScheduleItem = () => {
                if (!newScheduleItem.value.name) return;
                
                const item = {
                    id: Date.now(),
                    name: newScheduleItem.value.name,
                    time: newScheduleItem.value.time,
                    date: currentDay.value
                };
                
                scheduleList.value.push(item);
                newScheduleItem.value = { name: '', time: '' }; 
                showScheduleModal.value = false;
            }


            const openEditModal = (type, itemData) => {
                let label = '';
                if (type === 'Todo') label = 'ä»£è¾¦äº‹é …';
                else if (type === 'Shopping') label = 'è³¼ç‰©æ¸…å–®é …ç›®';
                else if (type === 'Schedule') label = 'è¡Œç¨‹é …ç›®';
                else if (type === 'Accounting') label = 'æ”¯å‡ºç´€éŒ„';
                else if (type === 'Flight') label = 'èˆªç­è³‡è¨Š';

                editingItem.value = { type: type, typeLabel: label, data: JSON.parse(JSON.stringify(itemData)) };
                showEditModal.value = true;
            }

            const saveEdit = () => {
                const item = editingItem.value;
                const itemId = item.data.id;

                if (item.type === 'Todo') {
                    const index = todoList.value.findIndex(i => i.id === itemId);
                    if (index !== -1) todoList.value[index] = item.data;
                } else if (item.type === 'Shopping') {
                    const index = shoppingList.value.findIndex(i => i.id === itemId);
                    if (index !== -1) shoppingList.value[index] = item.data;
                } else if (item.type === 'Accounting') {
                    const index = expenses.value.findIndex(i => i.id === itemId);
                    if (index !== -1) expenses.value[index] = item.data;
                } else if (item.type === 'Schedule') { 
                     const index = scheduleList.value.findIndex(i => i.id === itemId);
                    if (index !== -1) scheduleList.value[index] = item.data;
                } else if (item.type === 'Flight') {
                    flightInfo.value = item.data; 
                    fetchFlightStatus(); 
                }
                
                showEditModal.value = false;
            }

            const deleteItem = (listName, id) => {
                if (listName === 'Todo') {
                    todoList.value = todoList.value.filter(item => item.id !== id);
                } else if (listName === 'Shopping') {
                    shoppingList.value = shoppingList.value.filter(item => item.id !== id);
                } else if (listName === 'Accounting') {
                     expenses.value = expenses.value.filter(item => item.id !== id);
                } else if (listName === 'Schedule') { 
                    scheduleList.value = scheduleList.value.filter(item => item.id !== id);
                }
            }
            
            const deleteAndCloseEditModal = (type, id) => {
                if (confirm(`ç¢ºå®šè¦åˆªé™¤é€™ç­† ${editingItem.value.typeLabel} å—ï¼Ÿ`)) {
                    deleteItem(type, id);
                    showEditModal.value = false;
                }
            }
            
            const openModal = (tab) => {
                if (tab === 'Schedule') showScheduleModal.value = true;
                else if (tab === 'PreTrip') showTodoModal.value = true;
                else if (tab === 'Accounting') showAccountingModal.value = true;
                else if (tab === 'Shopping') showShoppingModal.value = true;
            }
            
            onMounted(() => {
                document.documentElement.style.setProperty('--primary-color', primaryColorInput.value);
                fetchExchangeRate(); 
                fetchWeather('Taipei'); 
                fetchFlightStatus(); 

                setInterval(() => {
                    fetchExchangeRate();
                    fetchFlightStatus();
                }, 300000); 
                
                if (currentTab.value === 'Accounting' && days.value.length > 1) {
                    newExpense.value.date = currentDay.value;
                }
            });

            return {
                appTitle, currentTab, tripStartDate, totalTripDays, 
                days, currentDay, currentDayLabel,
                primaryColor, primaryColorInput, appBgColor, updateTheme,
                fontOptions, selectedFont, 
                // è²¨å¹£èˆ‡åŒ¯ç‡
                baseCurrency, exchangeRate, baseCurrencySymbol, getCurrencySymbol, fetchExchangeRate, convertToBaseCurrency,
                // å¤©æ°£
                weatherLocation, weather, fetchWeather, 
                // èˆªç­
                flightInfo, fetchFlightStatus, 
                // è¨˜å¸³åŠŸèƒ½ç›¸é—œ
                expenses, expenseFilter, filteredExpenses, totalExpense,
                showAccountingModal, newExpense, addExpense,
                // æ¸…å–®åŠè¡Œç¨‹
                todoList, addTodoItem, newTodo, showTodoModal,
                shoppingList, addShoppingItem, newShoppingItem, showShoppingModal,
                scheduleList, filteredSchedule, addScheduleItem, newScheduleItem, showScheduleModal,
                // ç·¨è¼¯åŠŸèƒ½ç›¸é—œ
                showEditModal, editingItem, openEditModal, saveEdit, deleteAndCloseEditModal,
                // é€šç”¨
                openModal, deleteItem,
            }
        }
    }).mount('#app')
</script>

</body>
</html>
